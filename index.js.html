<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { gapiPromise } from './gapi'
import GoogleAuthService from './GoogleAuthService'
import { deprecatedMsg, getObjectCopy } from './utils'

const googleAuthService = new GoogleAuthService()
const {
  grantOfflineAccess,
  getOfflineAccessCode,
  login,
  logout,
  isAuthenticated,
  getUserData,
  refreshToken,
  isSignedIn,
  listenUserSignIn,
} = googleAuthService

/**
 * @class Vue
 */

/** @module vue-gapi */

/**
 * VueGapi plugin options and &lt;code>gapi.auth2.init&lt;/code> configuration parameters.
 *
 * @typedef {object} Options
 * @static
 * @see [gapi.client.init]{@link https://github.com/google/google-api-javascript-client/blob/master/docs/reference.md#----gapiclientinitargs--}
 *
 * @property {string} [apiKey] The API Key to use
 * @property {string[]} [discoveryDocs] An array of discovery doc URLs or discovery doc JSON objects
 * @property {string} [clientId] The app's client ID, found and created in the Google Developers Console
 * @property {string} [scope] The scopes to request, as a space-delimited string
 */

export default {
  /**
   * @param {Vue} Vue Vue constructor
   * @param {module:vue-gapi.Options} clientConfig VueGapi plugin options
   * @see [Using a Plugin]{@link https://vuejs.org/v2/guide/plugins.html#Using-a-Plugin}
   */
  install: function (Vue, clientConfig) {
    Vue.gapiLoadClientPromise = null
    googleAuthService.clientConfig = getObjectCopy(clientConfig)

    const resolveAuth2Client = (resolve, reject) => {
      gapiPromise.then(() => {
        const gapi = window.gapi
        if (!gapi) {
          console.error('Failed to load gapi!')
          return
        }
        if (!gapi.auth) {
          gapi.load('client:auth2', () => {
            Vue.gapiLoadClientPromise = gapi.client
              .init(clientConfig)
              .then(() => {
                console.info('gapi client initialised.')
                googleAuthService.authInstance = gapi.auth2.getAuthInstance()
                Vue.gapiLoadClientPromise.status = 0

                resolve(gapi)
              })
              .catch((err) => {
                if (err.error) {
                  const error = err.error
                  console.error(
                    'Failed to initialize gapi: %s (status=%s, code=%s)',
                    error.message,
                    error.status,
                    error.code,
                    err
                  )
                }
                reject(err)
              })
          })
        } else {
          resolve(gapi)
        }
      })
    }

    /**
     * @memberof Vue
     * @member {GoogleAuthService}
     *
     * @example
     * &lt;script>
     *   export default {
     *     name: 'my-component',
     *
     *     methods: {
     *       login() {
     *         this.$gapi.getGapiClient().then((gapi) => {
     *           // gapi.sheets.spreadsheet.get(...)
     *           // ...
     *         })
     *       },
     *     },
     *   }
     * &lt;/script>
     */
    Vue.prototype.$gapi = {
      /**
       * @memberof GoogleAuthService
       * @method GoogleAuthService#getGapiClient
       * @return {Promise&lt;GoogleAuth>}
       */
      getGapiClient: () => {
        return new Promise((resolve, reject) => {
          // A promise cannot be executed twice
          // In our case, once the promise has been resolve
          // we know that the `gapi` client is ready.
          if (
            Vue.gapiLoadClientPromise &amp;&amp;
            Vue.gapiLoadClientPromise.status === 0
          ) {
            return resolve(window.gapi)
          } else {
            resolveAuth2Client(resolve, reject)
          }
        })
      },
      getOfflineAccessCode,
      grantOfflineAccess: () => {
        return Vue.prototype.$gapi
          .getGapiClient()
          .then(grantOfflineAccess)
          .then(() => {
            googleAuthService.authInstance
              .grantOfflineAccess()
              .then((res) => {
                console.log(res)
                const refreshToken = res.code
                localStorage.setItem('gapi.refresh_token', refreshToken)
              })
              .catch(console.error)
          })
      },
      login: (res, rej) => {
        return Vue.prototype.$gapi.getGapiClient().then(() => login(res, rej))
      },
      refreshToken: () => {
        return Vue.prototype.$gapi.getGapiClient().then(refreshToken)
      },
      logout: (res, rej) => {
        return Vue.prototype.$gapi.getGapiClient().then(() => logout(res, rej))
      },
      listenUserSignIn: (callback) => {
        return Vue.prototype.$gapi
          .getGapiClient()
          .then(() => listenUserSignIn(callback))
      },
      isSignedIn: () => {
        return Vue.prototype.$gapi.getGapiClient().then(isSignedIn)
      },
      isAuthenticated,
      getUserData,
    }

    Vue.prototype.isGapiLoaded = () => {
      console.warn(deprecatedMsg('isGapiLoaded'))
      return Vue.gapiLoadClientPromise &amp;&amp; Vue.gapiLoadClientPromise.status === 0
    }

    /**
     * @memberof Vue
     * @deprecated since version 0.0.10.
     * Will be removed in version 1.0.
     */
    Vue.prototype.$getGapiClient = () => {
      console.warn(deprecatedMsg('$getGapiClient', '$gapi.getGapiClient'))
      return Vue.prototype.$gapi.getGapiClient()
    }

    /**
     * @memberof Vue
     * @deprecated since version 0.0.10.
     * Will be removed in version 1.0.
     */
    Vue.prototype.$login = () => {
      console.warn(deprecatedMsg('$login', '$gapi.login'))
      return Vue.prototype.$gapi.login()
    }

    /**
     * @memberof Vue
     * @deprecated since version 0.0.10.
     * Will be removed in version 1.0.
     */
    Vue.prototype.$refreshToken = () => {
      console.warn(deprecatedMsg('$refreshToken', '$gapi.refreshToken'))
      return Vue.prototype.$gapi.refreshToken()
    }

    /**
     * @memberof Vue
     * @deprecated since version 0.0.10.
     * Will be removed in version 1.0.
     */
    Vue.prototype.$logout = () => {
      console.warn(deprecatedMsg('$logout', '$gapi.logout'))
      return Vue.prototype.$gapi.logout()
    }

    /**
     * @memberof Vue
     * @deprecated since version 0.0.10.
     * Will be removed in version 1.0.
     */
    Vue.prototype.$isAuthenticated = () => {
      console.warn(deprecatedMsg('$isAuthenticated', '$gapi.isAuthenticated'))
      return Vue.prototype.$gapi.isAuthenticated()
    }

    /**
     * @memberof Vue
     * @deprecated since version 0.0.10.
     * Will be removed in version 1.0.
     */
    Vue.prototype.$isSignedIn = () => {
      console.warn(deprecatedMsg('$isAuthenticated', '$gapi.isAuthenticated'))
      return Vue.prototype.$gapi.isSignedIn()
    }

    /**
     * @memberof Vue
     * @deprecated since version 0.0.10.
     * Will be removed in version 1.0.
     */
    Vue.prototype.$getUserData = () => {
      console.warn(deprecatedMsg('$getUserData', '$gapi.getUserData'))
      return Vue.prototype.$gapi.getUserData()
    }
  },
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-vue-gapi.html">vue-gapi</a></li></ul><h3>Classes</h3><ul><li><a href="GoogleAuthService.html">GoogleAuthService</a></li><li><a href="Vue.html">Vue</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Sat Dec 05 2020 17:46:19 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
